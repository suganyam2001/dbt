SELECT
  C.STATE,
  C.TYPE,
  MEDIAN(C.PRICE) AS median_rental_price,
  M.MEDIAN_HOUSEHOLD_INCOME,
  J.QUALITYOFLIFEQUALITYOFLIFE,
  J.QUALITYOFLIFEAFFORDABILITY,
  J.QUALITYOFLIFEECONOMY,
  J.QUALITYOFLIFEEDUCATIONANDHEALTH,
  J.QUALITYOFLIFESAFETY
FROM {{ ref('refined_median_income') }} M
JOIN {{ ref('refined_qol_data') }} J
  ON UPPER(M.STATE) = UPPER(J.STATE)
JOIN {{ ref('refined_housing_data') }} C
  ON UPPER(M.STATE) = UPPER(C.STATE)
GROUP BY
  C.STATE,
  C.TYPE,
  J.QUALITYOFLIFEQUALITYOFLIFE,
  J.QUALITYOFLIFEAFFORDABILITY,
  J.QUALITYOFLIFEECONOMY,
  J.QUALITYOFLIFEEDUCATIONANDHEALTH,
  J.QUALITYOFLIFESAFETY,
  M.MEDIAN_HOUSEHOLD_INCOME
ORDER BY
  C.STATE,
  C.TYPEsinjenwojwc